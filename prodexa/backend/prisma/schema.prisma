datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  passwordHash String?
  role         Role     @default(MANAGER)
  createdAt    DateTime @default(now())

  projects Project[]
}

model Project {
  id        String        @id @default(uuid())
  name      String
  repoUrl   String
  ownerName String
  status    ProjectStatus @default(ACTIVE)
  createdAt DateTime      @default(now())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  metrics             ProjectActivity[]
  predictions         Prediction[]
  developerActivities DeveloperActivity[] // bidirectional relation added
}

model ProjectActivity {
  id                String   @id @default(uuid())
  projectId         String
  commitFrequency   Int
  pullRequestCount  Int
  issueCount        Int
  contributorCount  Int
  productivityScore Int?
  activityTimestamp DateTime @default(now())

  project Project @relation(fields: [projectId], references: [id])
}

model Prediction {
  id                String   @id @default(uuid())
  projectId         String
  productivityScore Float
  deliveryRisk      String
  workloadForecast  Float
  generatedAt       DateTime @default(now())

  project Project @relation(fields: [projectId], references: [id])
}

model DeveloperActivity {
  id                String   @id @default(uuid())
  projectId         String
  developerLogin    String
  commits           Int
  pullRequestCount  Int
  issueCount        Int
  productivityScore Int
  activityTimestamp DateTime @default(now())

  project Project @relation(fields: [projectId], references: [id])

  @@index([projectId, developerLogin])
}

enum Role {
  ADMIN
  MANAGER
}

enum ProjectStatus {
  ACTIVE
  INACTIVE
}
